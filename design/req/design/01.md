## 3. Proposed Architecture

### 3.1 High-Level System Map

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        AWS CALC AUTOMATOR                                   │
│                                                                             │
│                        ┌──────────────────┐                                │
│                        │   CLI Entry Point │                                │
│                        │   (main.py)       │                                │
│                        └────────┬─────────┘                                │
│                                 │                                           │
│               ┌─────────────────┼─────────────────┐                        │
│               │                                   │                        │
│               ▼                                   ▼                        │
│   ┌───────────────────────┐         ┌──────────────────────────┐           │
│   │   MODE A              │         │   MODE B                 │           │
│   │   Interactive Builder │         │   Automation Runner      │           │
│   └───────────┬───────────┘         └────────────┬─────────────┘           │
│               │                                  │                         │
│               ▼                                  ▼                         │
│   ┌───────────────────────┐         ┌──────────────────────────┐           │
│   │   Service Catalog     │         │   Profile Loader         │           │
│   │   (built-in list of   │         │   + Schema Validator     │           │
│   │    supported services │         └────────────┬─────────────┘           │
│   │    and dimensions)    │                      │                         │
│   └───────────┬───────────┘                      │                         │
│               │                                  │                         │
│               └──────────────┬───────────────────┘                         │
│                              │                                              │
│                              ▼                                              │
│                ┌─────────────────────────┐                                 │
│                │    Value Resolver       │                                 │
│                │  (priority chain +      │                                 │
│                │   CLI prompt engine)    │                                 │
│                └─────────────┬───────────┘                                 │
│                              │                                              │
│               ┌──────────────┼──────────────┐                              │
│               │              │              │                              │
│               ▼              ▼              ▼                              │
│          all good?        missing?      profile                            │
│               │           ABORT          write                             │
│               │                       (Mode A)                            │
│               ▼                                                            │
│   ┌───────────────────────────────────────────────────────────┐            │
│   │                  Browser Automation Engine                │            │
│   │                      (Playwright)                         │            │
│   │                                                           │            │
│   │   ┌─────────────┐   ┌─────────────┐   ┌──────────────┐  │            │
│   │   │  Navigator  │   │  Find-in-   │   │  Field       │  │            │
│   │   │  (page nav, │   │  Page       │   │  Interactor  │  │            │
│   │   │   groups,   │   │  Locator    │   │  (type,      │  │            │
│   │   │   search)   │   │             │   │   select,    │  │            │
│   │   └─────────────┘   └─────────────┘   │   toggle)    │  │            │
│   │                                        └──────────────┘  │            │
│   └───────────────────────────┬───────────────────────────────┘            │
│                               │                                            │
│                               ▼                                            │
│                ┌──────────────────────────────┐                            │
│                │      Artifact Emitter        │                            │
│                │  run_result.json             │                            │
│                │  /screenshots/*.png          │                            │
│                └──────────────────────────────┘                            │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 3.2 Project Directory Structure

```
aws-cost/
│
├── main.py                        ← CLI entry point (build/run/explore/promote)
│
├── config/
│   ├── json-schema.json           ← Profile schema v2.0 definition
│   ├── run-result-schema.json     ← Run result artifact schema
│   ├── region_map.json            ← AWS region code → display name mapping
│   ├── service_catalog_loader.py  ← Modular catalog loader utility
│   ├── option_descriptions_map.json ← Global option descriptions cache
│   ├── services/                  ← Modular service catalogs (NEW in v1.1)
│   │   ├── README.md
│   │   ├── ec2.json               ← Amazon EC2 catalog
│   │   ├── s3.json                ← Amazon S3 catalog
│   │   ├── rds_mysql.json         ← Amazon RDS for MySQL
│   │   ├── rds_postgresql.json    ← Amazon RDS for PostgreSQL
│   │   ├── lambda.json            ← AWS Lambda
│   │   ├── cloudfront.json        ← Amazon CloudFront
│   │   ├── amazon_api_gateway.json ← Amazon API Gateway
│   │   └── generated/             ← Explore-mode draft outputs
│   │       └── lambda_draft.json
│   └── service_catalog.json       ← Legacy monolithic catalog (fallback)
│
├── core/
│   ├── __init__.py
│   ├── models.py                  ← Pydantic data contracts (Profile, Catalog, Run)
│   ├── profile_loader.py          ← Load + validate profile against schema
│   ├── value_resolver.py          ← Priority chain + override application
│   ├── artifact_emitter.py        ← Write run_result.json, manage screenshots
│   └── keyboard_shortcuts.py      ← OS-aware keyboard shortcut utilities
│
├── builder/
│   ├── __init__.py
│   ├── interactive_builder.py     ← Mode A: TUI wizard with live preview
│   ├── layout_engine.py           ← Split/single-column terminal layout
│   ├── yaml_preview.py            ← Live YAML preview serialization
│   ├── compound_input.py          ← Value+unit compound input parsing
│   ├── scrollable_preview.py      ← Auto-scrolling YAML preview panel
│   ├── service_prompt_policies.py ← Service-specific prompt visibility
│   └── yaml_preview.py            ← YAML preview rendering with highlighting
│
├── automation/
│   ├── __init__.py
│   ├── browser_session.py         ← Launch Playwright, manage page lifecycle
│   ├── navigator.py               ← Open calculator, create groups, search services
│   ├── find_in_page_locator.py    ← Ctrl+F strategy to locate dimension labels
│   ├── field_interactor.py        ← Type / select / toggle resolved values
│   ├── catalog_healer.py          ← Self-healing catalog CSS selector updates
│   └── section_strategy_hints.py  ← Section expansion strategy hints
│
├── explorer/                      ← Mode C: Explore-mode implementation
│   ├── __init__.py
│   ├── interactive_explorer.py    ← 9-step exploration wizard
│   ├── draft_writer.py            ← Write draft catalog JSONs
│   ├── draft_promoter.py          ← Mode D: Promote draft to validated catalog
│   ├── dom_scanner.py             ← DOM inventory scanner
│   ├── section_explorer.py        ← Section discovery and expansion
│   ├── options_scanner.py         ← Dropdown option capture
│   ├── conflict_resolver.py       ← Dimension conflict resolution
│   ├── vision_gate.py             ← VLM vision-based verification gate
│   └── core/
│       ├── phase1_search.py       ← Launch calculator, search service
│       ├── phase4_dimensions.py   ← BFS dimension discovery
│       ├── phase5_draft.py        ← Draft assembly and normalization
│       ├── control_snapshot.py    ← Control state capture
│       ├── capture_quality_gate.py ← Quality thresholds for drafts
│       └── utils.py               ← Utility functions
│
├── profiles/                      ← User-created profile files
│   ├── example.json
│   └── .wizard_recovery/          ← Recovery snapshots (optional)
│       └── project.partial.json
│
├── outputs/                       ← Run artifacts
│   ├── run_result.json
│   └── screenshots/
│       └── svc_002_step_3_fail.png
│
├── scripts/
│   ├── run_explore_py312.sh       ← Python 3.12 helper for explore mode
│   └── generate_service_template.py ← Template generator for new services
│
├── tests/                         ← Unit + integration tests
│   ├── test_profile_loader.py
│   ├── test_value_resolver.py
│   ├── test_field_interactor.py
│   ├── test_interactive_builder.py
│   ├── test_yaml_preview.py
│   ├── test_compound_input.py
│   ├── test_layout_engine.py
│   └── test_explorer_capture_quality.py
│
├── design/                        ← Design documentation
│   ├── 01.md                      ← This architecture document
│   ├── 00-req.md                  ← Requirements overview
│   ├── PRD.md                     ← Product Requirements Document
│   ├── SDD.md                     ← Software Design Document
│   ├── 03-playwright-automation-spec.md
│   ├── 05-failure-observability-spec.md
│   └── 06-guideline.md
│
├── artifacts/                     ← Additional artifacts
├── fix/                           ← Fix scripts
└── requirements.txt
```

---

### 3.3 Module Responsibilities

```
┌──────────────────────────────────────────────────────────────────────────┐
│  MODULE MAP                                                              │
│                                                                          │
│  main.py                                                                 │
│  ├── parse CLI args (build/run/explore/promote)                         │
│  ├── route to builder, automation, explorer, or promoter pipeline       │
│  ├── handle top-level exceptions and exit codes                         │
│  └── enforce Python 3.10+ runtime requirement                           │
│                                                                          │
│  core/models.py                                                          │
│  ├── ProfileDocument, Group, Service, Dimension                         │
│  ├── ServiceCatalogEntry, CatalogDimension                              │
│  ├── RunResult, GroupResult, ServiceResult                              │
│  ├── DraftDimension, ServiceDraft, ScanMeta                             │
│  └── Type aliases: FieldType, ResolutionStatus, RunStatus, etc.         │
│                                                                          │
│  core/profile_loader.py                                                  │
│  ├── read JSON file from disk                                            │
│  ├── validate against json-schema.json (jsonschema library)             │
│  ├── cross-field validation (service/region/dimension)                  │
│  └── return typed ProfileDocument dataclass                              │
│                                                                          │
│  core/value_resolver.py                                                  │
│  ├── walk every group → service → dimension                             │
│  ├── apply priority chain (user → default → prompt → abort)            │
│  ├── apply --set overrides before resolution                            │
│  ├── collect all missing required fields before raising                 │
│  └── return fully resolved dimension map                                │
│                                                                          │
│  core/artifact_emitter.py                                                │
│  ├── accumulate per-service results during run                         │
│  ├── write outputs/run_result.json on completion                       │
│  ├── manage screenshot paths and naming conventions                     │
│  └── support verify/fill/dry_run run modes                              │
│                                                                          │
│  config/service_catalog_loader.py                                        │
│  ├── load modular catalogs from config/services/*.json                  │
│  ├── validate against ServiceCatalogEntry Pydantic model                │
│  ├── provide get_service_by_name/search_term helpers                    │
│  └── fallback to legacy service_catalog.json if needed                  │
│                                                                          │
│  builder/interactive_builder.py                                          │
│  ├── TUI flow: project name → groups → services → dimensions           │
│  ├── live YAML preview state updates                                    │
│  ├── section-driven prompt orchestration                                │
│  ├── compound value+unit input detection                                │
│  ├── inline help interception (? / ?v commands)                         │
│  ├── section review/edit loop                                           │
│  ├── service review/edit/restart loop                                   │
│  ├── final profile review loop                                          │
│  ├── optional --recover snapshot mechanism                              │
│  └── serializes final answers to profile.json                           │
│                                                                          │
│  builder/layout_engine.py                                                │
│  ├── split/single-column terminal layout management                     │
│  ├── Rich Live lifecycle with questionary pause/resume                  │
│  └── preview state tracking and scroll positioning                      │
│                                                                          │
│  builder/yaml_preview.py                                                 │
│  ├── live YAML preview serialization                                    │
│  ├── active-key highlighting                                            │
│  └── width-safe key truncation for panel rendering                      │
│                                                                          │
│  builder/compound_input.py                                               │
│  ├── detect value+unit compound dimensions                              │
│  ├── parse compound input strings                                       │
│  └── validate units against allowed list                                │
│                                                                          │
│  automation/browser_session.py                                           │
│  ├── launch Playwright (headed by default, --headless flag)            │
│  ├── manage single page context                                         │
│  └── provide screenshot() helper called by other modules on error      │
│                                                                          │
│  automation/navigator.py                                                 │
│  ├── navigate to calculator.aws/#/estimate                              │
│  ├── create named service groups                                        │
│  ├── search for service by name + click correct match                  │
│  ├── select region in Add Service panel                                 │
│  ├── expand collapsible sections via strategy funcs                     │
│  └── save service to estimate                                           │
│                                                                          │
│  automation/find_in_page_locator.py                                      │
│  ├── trigger browser Find in Page with dimension label as search term  │
│  ├── resolve nearest interactive element to the highlighted match      │
│  ├── detect field type via DOM role/tag analysis                        │
│  └── return element handle + detected field type                        │
│                                                                          │
│  automation/field_interactor.py                                          │
│  ├── receive element handle + field type + resolved value              │
│  ├── type value into input[type=number or text]                        │
│  ├── select option in dropdowns / listboxes                            │
│  ├── click to set boolean toggles / checkboxes                         │
│  └── handle instance search table selection                             │
│                                                                          │
│  automation/catalog_healer.py                                            │
│  ├── track CSS selector updates during runtime                          │
│  ├── write healed selectors back to catalog files                       │
│  └── disable via --no-heal flag                                         │
│                                                                          │
│  explorer/interactive_explorer.py                                        │
│  ├── 9-step exploration wizard                                          │
│  ├── DOM scanning + VLM vision gate                                     │
│  ├── section discovery and expansion                                    │
│  ├── BFS-based dimension exploration                                    │
│  ├── gate control discovery (CHECKBOX_TOGGLE, RADIO_CARD, etc.)         │
│  ├── draft catalog assembly                                             │
│  └── chain into promoter flow                                           │
│                                                                          │
│  explorer/draft_promoter.py                                              │
│  ├── load draft from config/services/generated/                         │
│  ├── normalize to ServiceCatalogEntry schema                            │
│  ├── auto-infer UNKNOWN field types via heuristics                      │
│  ├── interactive cleanup of dimensions                                  │
│  ├── quality gate evaluation                                            │
│  └── write validated catalog to config/services/                        │
│                                                                          │
│  explorer/dom_scanner.py                                                 │
│  ├── scan visible DOM elements                                          │
│  ├── extract roles, attributes, text content                            │
│  └── compute bounding boxes via CDP                                     │
│                                                                          │
│  explorer/section_explorer.py                                            │
│  ├── discover collapsible sections via panel headers                    │
│  ├── expand sections via trigger strategies                             │
│  └── filter noise sections (footer actions, region labels)              │
│                                                                          │
│  explorer/options_scanner.py                                             │
│  ├── capture dropdown options for SELECT/RADIO/COMBOBOX                 │
│  └── handle dynamic option loading                                      │
│                                                                          │
│  explorer/vision_gate.py                                                 │
│  ├── VLM-based visual verification of captured dimensions               │
│  ├── confidence scoring                                                 │
│  └── flag low-confidence captures for review                            │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

---

### 3.4 Data Flow — End to End

```
  ┌──────────────┐     ┌────────────────┐     ┌──────────────────────┐
  │ profile.json │────►│ profile_loader │────►│  ProfileDocument     │
  └──────────────┘     └────────────────┘     │  (typed dataclass)   │
                                              └──────────┬───────────┘
                                                         │
                                                         ▼
                                              ┌──────────────────────┐
                                              │  value_resolver      │
                                              │                      │
                                              │  dimension: {        │
                                              │    key: "Instance"   │
                                              │    user_value: null  │──► prompt ──► "t3.medium"
                                              │    default: "micro"  │
                                              │  }                   │
                                              └──────────┬───────────┘
                                                         │
                                              resolved dimension map
                                                         │
                                                         ▼
                                              ┌──────────────────────┐
                                              │  navigator           │
                                              │                      │
                                              │  1. open calculator  │
                                              │  2. create group     │
                                              │  3. search service   │
                                              │  4. set region       │
                                              └──────────┬───────────┘
                                                         │
                                              per dimension:
                                                         │
                                                         ▼
                                              ┌──────────────────────┐
                                              │  find_in_page_locator│
                                              │                      │
                                              │  Ctrl+F              │
                                              │  "Instance Type"     │──► element handle
                                              │                      │    + field_type: dropdown
                                              └──────────┬───────────┘
                                                         │
                                                         ▼
                                              ┌──────────────────────┐
                                              │  field_interactor    │
                                              │                      │
                                              │  select("t3.medium") │
                                              └──────────┬───────────┘
                                                         │
                                                 success / fail
                                                         │
                                                         ▼
                                              ┌──────────────────────┐
                                              │  artifact_emitter    │
                                              │                      │
                                              │  run_result.json     │
                                              │  screenshots/ (fail) │
                                              └──────────────────────┘
```

---

### 3.5 Find-in-Page Locator — Internal Logic

```
  INPUT: dimension label = "Data Transfer Out"
  ─────────────────────────────────────────────────────────────────────
  Step 1  Trigger Playwright keyboard shortcut  Ctrl+F  (or Cmd+F)
          │
  Step 2  Type label string into the browser's native find bar
          │
  Step 3  Browser highlights first match on the visible page
          │
  Step 4  Read highlighted element's bounding box via CDP
          │
  Step 5  Search DOM within ±200px vertical band of the match
          │  for interactive elements:
          │
          ├─► input[type="number"]   ──► field_type: NUMBER
          ├─► input[type="text"]     ──► field_type: TEXT
          ├─► select                 ──► field_type: SELECT
          ├─► [role="combobox"]      ──► field_type: COMBOBOX
          ├─► [role="switch"]        ──► field_type: TOGGLE
          └─► [role="radio"]         ──► field_type: RADIO
          │
  Step 6  Return (element_handle, field_type) to field_interactor
          │
  FALLBACK: if no match found after 2 retries
          └─► log warning, capture screenshot, mark dimension as SKIPPED
  ─────────────────────────────────────────────────────────────────────
```

---

### 3.6 run_result.json Structure

```json
{
  "schema_version": "2.0",
  "run_id": "run_20240315_143022",
  "profile_name": "E-Commerce Replatform",
  "status": "partial_success",
  "started_at": "2024-03-15T14:30:22Z",
  "completed_at": "2024-03-15T14:32:41Z",
  "calculator_url": "https://calculator.aws/#/estimate?id=abc123",
  "groups": [
    {
      "group_name": "Frontend Web Tier",
      "services": [
        {
          "service_name": "Amazon EC2",
          "human_label": "Web Servers",
          "status": "success",
          "dimensions_filled": 3,
          "dimensions_skipped": 0,
          "dimensions_failed": 0
        },
        {
          "service_name": "Amazon CloudFront",
          "human_label": "CDN",
          "status": "failed",
          "failed_step": "find_dimension",
          "failed_dimension": "Data Transfer Out",
          "screenshot": "outputs/screenshots/cloudfr_dim_fail.png",
          "dimensions_filled": 0,
          "dimensions_skipped": 0,
          "dimensions_failed": 1
        }
      ]
    }
  ]
}
```

---

### 3.7 Key Dependency Stack

```
┌──────────────────────────────────────────────────────────┐
│  RUNTIME DEPENDENCIES                                    │
│                                                          │
│  playwright          Browser automation + CDP access     │
│  jsonschema          Profile validation against schema   │
│  questionary         Interactive CLI prompts (Mode A)    │
│  rich                Terminal output, progress bars      │
│  pydantic            Typed profile dataclasses           │
│  pytest              Unit + integration tests            │
└──────────────────────────────────────────────────────────┘

  Python 3.11+
       │
       ├── playwright ──► Chromium (bundled, no separate install)
       ├── jsonschema
       ├── questionary
       ├── rich
       └── pydantic
```
### 3.8 Service Catalog Structure

The service catalog is the backbone of both modes. It is a static JSON file maintained alongside the codebase that declares every supported AWS service, its known dimensions, and enough metadata for the automator to interact correctly with each field type.

```json
{
  "catalog_version": "2.0",
  "services": [
    {
      "service_name": "Amazon EC2",
      "search_term": "EC2",
      "calculator_page_title": "Amazon EC2",
      "supported_regions": ["us-east-1", "us-west-2", "eu-west-1"],
      "dimensions": [
        {
          "key": "Operating System",
          "field_type": "SELECT",
          "options": ["Linux", "Windows", "RHEL", "SUSE"],
          "default_value": "Linux",
          "required": true
        },
        {
          "key": "Instance Type",
          "field_type": "COMBOBOX",
          "default_value": "t3.micro",
          "required": true
        },
        {
          "key": "Number of Instances",
          "field_type": "NUMBER",
          "unit": null,
          "default_value": 1,
          "required": true
        },
        {
          "key": "Utilization",
          "field_type": "NUMBER",
          "unit": "percent",
          "default_value": 100,
          "required": false
        }
      ]
    },
    {
      "service_name": "Amazon S3",
      "search_term": "S3",
      "calculator_page_title": "Amazon Simple Storage Service (S3)",
      "dimensions": [
        {
          "key": "S3 Standard storage",
          "field_type": "NUMBER",
          "unit": "GB",
          "default_value": 100,
          "required": true
        },
        {
          "key": "GET, SELECT, and all other requests",
          "field_type": "NUMBER",
          "unit": "requests",
          "default_value": 0,
          "required": false
        }
      ]
    }
  ]
}
```

```
SERVICE CATALOG ROLE IN EACH MODE
─────────────────────────────────────────────────────────────────────
  MODE A (Builder)                    MODE B (Automator)
  ─────────────────────               ────────────────────────────
  Present service list to user        Provide field_type so
  Show available dimensions           field_interactor knows HOW
  Offer default values                to fill each element
  Validate user entries               Confirm dimension key exists
  against known options               before attempting Find in Page
─────────────────────────────────────────────────────────────────────
```

---

### 3.9 Interactive Builder — Detailed Flow (Mode A) — Redesigned Wizard

```
  START: python main.py build [--recover]
  │
  ├─► Pre-flight: Load service catalogs + region map
  │     ├─► Load all catalogs via service_catalog_loader
  │     └─► Load region_map.json for region selection
  │
  ├─► Recovery Check (if --recover flag)
  │     ├─► Scan profiles/.wizard_recovery/ for partial snapshots
  │     ├─► If found: prompt "Recover session from <path>?"
  │     └─► If yes: load partial state, resume from last section
  │
  ├─► Step 1: Project Metadata
  │     ├─► Prompt: Project name?
  │     │     └──► "E-Commerce Replatform"
  │     │
  │     └─► Prompt: Project description? (optional)
  │           └──► "Monthly estimate for core infrastructure"
  │
  ├─► Step 2: Group Loop
  │     │
  │     ├─► Prompt: Add a service group?
  │     │     └──► Yes
  │     │
  │     ├─► Prompt: Group name?
  │     │     └──► "Frontend Web Tier"
  │     │
  │     ├─► Prompt: Parent group? (optional, for nesting)
  │     │     └──► (skip for top-level groups)
  │     │
  │     └─► Step 3: Service Selection Loop
  │           │
  │           ├─► Show service picker (from catalog):
  │           │   ┌─────────────────────────────────────────┐
  │           │   │  Select an AWS Service                  │
  │           │   │  ──────────────────────────────────     │
  │           │   │  > Amazon EC2                           │
  │           │   │    Amazon S3                            │
  │           │   │    Amazon RDS for MySQL                 │
  │           │   │    AWS Lambda                           │
  │           │   │    Amazon CloudFront                    │
  │           │   │    [type to filter...]                  │
  │           │   └─────────────────────────────────────────┘
  │           │
  │           ├─► Selected: "Amazon EC2"
  │           │
  │           ├─► Prompt: Human label for this service?
  │           │     └──► "Web Servers"
  │           │
  │           ├─► Prompt: Region?
  │           │     ├─► Present full region_map.json list
  │           │     ├─► Filter by typeahead
  │           │     └──► "us-east-1"
  │           │
  │           └─► Step 4: Dimension Prompting (Section-Driven)
  │                 │
  │                 ├─► Load catalog dimensions for EC2
  │                 ├─► Group dimensions by section
  │                 ├─► Detect compound value+unit pairs
  │                 ├─► Detect TOGGLE-gated sections
  │                 │
  │                 ├─► Layout Engine: Split or Single Column?
  │                 │   ├─► If terminal width >= 120: split layout
  │                 │   │   ├─► Left: prompt panel (50%)
  │                 │   │   └─► Right: YAML preview (50%)
  │                 │   └─► Else: single column with ?v for preview
  │                 │
  │                 ├─► For each section:
  │                 │   │
  │                 │   ├─► PHASE 1: Toggle Checklist (if section has TOGGLEs)
  │                 │   │   ├─► Display section context + description
  │                 │   │   ├─► Show toggle options as checkboxes
  │                 │   │   │   ┌──────────────────────────────────────────┐
  │                 │   │   │   │  Enable EBS storage?  [✓] Yes  [ ] No   │
  │                 │   │   │   │  Section: Elastic Block Store config    │
  │                 │   │   │   └──────────────────────────────────────────┘
  │                 │   │   ├─► User selects toggles
  │                 │   │   └─► Preview updated with enabled structure
  │                 │   │
  │                 │   └─► PHASE 2: Dimension Prompts
  │                 │       │
  │                 │       ├─► For each dimension in section:
  │                 │       │   ├─► Apply service prompt policy (visibility)
  │                 │       │   ├─► Skip if hidden by disabled TOGGLE
  │                 │       │   ├─► Compound detection:
  │                 │       │   │   ├─► If value+unit pair detected:
  │                 │       │   │   │   ├─► Prompt: "Storage amount (GB)?"
  │                 │       │   │   │   ├─► User: "100"
  │                 │       │   │   │   ├─► Parse: value=100, unit="GB"
  │                 │       │   │   │   └─► Validate unit against allowed
  │                 │       │   │   │
  │                 │       │   │   └─► Else: standard prompt
  │                 │       │   │
  │                 │       │   ├─► Field badges displayed:
  │                 │       │   │   ┌────────────────────────────────────┐
  │                 │       │   │   │  Storage amount                   │
  │                 │       │   │   │  Type: [NUMBER]  [required]       │
  │                 │       │   │   │  Constraints: Min: 1, Max: 65536  │
  │                 │       │   │   │  Related: EBS IOPS, Throughput    │
  │                 │       │   │   └────────────────────────────────────┘
  │                 │       │   │
  │                 │       │   ├─► Inline help commands:
  │                 │       │   │   ├─► [?] Field help → expanded panel
  │                 │       │   │   └─► [?v] YAML preview → scrollable view
  │                 │       │   │
  │                 │       │   ├─► User input:
  │                 │       │   │   ├─► [U] Set user_value now
  │                 │       │   │   ├─► [D] Use default
  │                 │       │   │   └─► [P] Prompt at run time
  │                 │       │   │
  │                 │       │   └─► Update preview state
  │                 │       │
  │                 │       └─► Section Review Loop:
  │                 │           ├─► Display summary table
  │                 │           ├─► Options:
  │                 │           │   ├─► [1] Edit this field
  │                 │           │   ├─► [N] Next section
  │                 │           │   └─► [S] Save section
  │                 │           └─► After save: continue to next section
  │                 │
  │                 └─► Service Review Loop (after all sections):
  │                     ├─► Display full service summary
  │                     ├─► Options:
  │                     │   ├─► [1] Edit a field in this service
  │                     │   ├─► [2] Restart this service
  │                     │   └─► [S] Save service
  │                     └─► After save: add to group
  │
  │           └─► Add another service to this group? ──► Yes / No
  │
  │     └─► Add another group? ──► Yes / No
  │
  ├─► Step 5: Final Profile Review
  │     │
  │     ├─► Display full YAML preview
  │     ├─► Options:
  │     │   ├─► [S] Save profile
  │     │   ├─► [E] Edit a service
  │     │   │   ├─► Select service to edit
  │     │   │   ├─► Route to Service Review Loop
  │     │   │   └─► Post-edit: Edit another / Return to review
  │     │   ├─► [R] Start over (discard all, restart wizard)
  │     │   │   └─► Confirm: "Discard N groups with M services?"
  │     │   └─► [Q] Quit without saving
  │     │
  │     └─► If Save:
  │         ├─► Validate against json-schema.json
  │         ├─► Write to profiles/<project_slug>.json
  │         ├─► Clean up recovery snapshot (if --recover)
  │         └─► Print summary table
  │
  ├─► Recovery Snapshot Writes (during wizard)
  │     ├─► After each section: write to profiles/.wizard_recovery/
  │     ├─► On Ctrl+C: save cancellation snapshot
  │     └─► Format: <project_slug>.partial.json
  │
  └─► Post-Build Prompt
        ├─► "Run now with --run?" ──► Yes / No
        └─► If Yes: chain into run mode
```

---

### 3.9.1 Builder Wizard Features

```
┌────────────────────────────────────────────────────────────────────┐
│  FEATURE                    │  DESCRIPTION                         │
├────────────────────────────────────────────────────────────────────┤
│  Live YAML Preview          │  Real-time preview updates as user  │
│                             │  progresses through prompts          │
│                             │  - Auto-scrolls to active field     │
│                             │  - Highlights current key           │
│                             │  - Truncates long keys safely       │
├────────────────────────────────────────────────────────────────────┤
│  Split Layout Engine        │  Adaptive terminal layout:          │
│                             │  - Split (50/50) on wide terminals  │
│                             │  - Single column on narrow          │
│                             │  - Rich Live with pause/resume      │
├────────────────────────────────────────────────────────────────────┤
│  Compound Input Detection   │  Detect value+unit pairs:           │
│                             │  - "Storage amount" + "GB"          │
│                             │  - Single prompt: "100" → parsed    │
│                             │  - Validates unit against allowed   │
├────────────────────────────────────────────────────────────────────┤
│  Section-Driven Prompts     │  Group dimensions by section:       │
│                             │  - Reduces cognitive load           │
│                             │  - Section descriptions shown       │
│                             │  - Progress: [N / M] per section    │
├────────────────────────────────────────────────────────────────────┤
│  TOGGLE-Gated Sections      │  Two-phase prompting:               │
│                             │  - Phase 1: Toggle checklist        │
│                             │  - Phase 2: Child dimensions        │
│                             │  - Disabled toggles skip children   │
├────────────────────────────────────────────────────────────────────┤
│  Inline Help Commands       │  Contextual help during prompts:    │
│                             │  - [?] Field help (expanded panel)  │
│                             │  - [?v] YAML preview (scrollable)   │
│                             │  - [?u]/[?d] Scroll preview         │
├────────────────────────────────────────────────────────────────────┤
│  Field Metadata Badges      │  Display field context:             │
│                             │  - Type badge (NUMBER, SELECT, etc.)│
│                             │  - Required/optional indicator      │
│                             │  - Constraints (min/max/step)       │
│                             │  - Related fields list              │
├────────────────────────────────────────────────────────────────────┤
│  Section Review Loop        │  Post-section edit/review:          │
│                             │  - Edit individual fields           │
│                             │  - Multi-select bulk edits          │
│                             │  - Save and continue                │
├────────────────────────────────────────────────────────────────────┤
│  Service Review Loop        │  Post-service edit/restart:         │
│                             │  - Edit field in service            │
│                             │  - Restart entire service           │
│                             │  - Save and add to group            │
├────────────────────────────────────────────────────────────────────┤
│  Final Review Loop          │  Profile-level review:              │
│                             │  - Edit service (loops back)        │
│                             │  - Start over (confirm discard)     │
│                             │  - Save profile                     │
├────────────────────────────────────────────────────────────────────┤
│  Recovery Snapshots         │  Optional --recover flag:           │
│                             │  - Section-level checkpoints        │
│                             │  - Cancelation saves                │
│                             │  - Auto-cleanup on success          │
├────────────────────────────────────────────────────────────────────┤
│  Option Descriptions        │  Enhanced SELECT/RADIO prompts:     │
│                             │  - Multi-line option descriptions   │
│                             │  - Global lookup cache              │
│                             │  - Catalog-specific overrides       │
└────────────────────────────────────────────────────────────────────┘
```

---

### 3.10 Automation Engine — Detailed Sequence (Mode B)

```
  START: python main.py --run --profile profiles/e-commerce-replatform.json
  │
  ├─► profile_loader: read + validate JSON
  │
  ├─► value_resolver: walk all dimensions
  │     │
  │     ├─► "Number of Instances" has user_value: null, no default
  │     │     └──► CLI: "How many web instances?"  ──► user enters 3
  │     │
  │     └─► all resolved ──► proceed
  │
  ├─► browser_session: launch Playwright / Chromium (headed)
  │     └──► navigate to https://calculator.aws/#/estimate
  │
  ├─► navigator: wait for page ready
  │
  ├─► GROUP LOOP  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  │   │
  │   ├─► Create group "Frontend Web Tier" in calculator
  │   │
  │   ├─► SERVICE LOOP  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  │   │   │
  │   │   ├─► Click "Add service"
  │   │   ├─► Search "EC2" ──► click "Amazon EC2" match
  │   │   ├─► Set region: "US East (N. Virginia)"  [us-east-1 mapped]
  │   │   │
  │   │   ├─► DIMENSION LOOP  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  │   │   │   │
  │   │   │   ├─► dim: "Operating System"  value: "Linux"
  │   │   │   │     find_in_page_locator("Operating System")
  │   │   │   │     field_type: SELECT
  │   │   │   │     field_interactor.select("Linux")        ✓
  │   │   │   │
  │   │   │   ├─► dim: "Instance Type"  value: "t3.medium"
  │   │   │   │     find_in_page_locator("Instance Type")
  │   │   │   │     field_type: COMBOBOX
  │   │   │   │     field_interactor.combobox("t3.medium")  ✓
  │   │   │   │
  │   │   │   └─► dim: "Number of Instances"  value: 3
  │   │   │         find_in_page_locator("Number of Instances")
  │   │   │         field_type: NUMBER
  │   │   │         field_interactor.type(3)                ✓
  │   │   │
  │   │   ├─► Click "Add to my estimate"
  │   │   ├─► Assign to group "Frontend Web Tier"
  │   │   └─► artifact_emitter.record_service(status=success)
  │   │
  │   └─► Repeat for next service...
  │
  └─► artifact_emitter.finalize()
        ├─► capture calculator shareable URL
        └─► write outputs/run_result.json
```

---

### 3.10.1 Explore Mode — Detailed Flow (Mode C)

```
  START: python main.py explore --service lambda
  │
  ├─► Pre-flight checks
  │     ├─► Check Python version (3.10-3.12 recommended for vision pipeline)
  │     └─► Validate service name or prompt for selection
  │
  ├─► browser_session: launch Playwright / Chromium (headed by default)
  │     └──► navigate to https://calculator.aws/#/estimate
  │
  ├─► PHASE 1: Launch and Search
  │     ├─► Click "Add service" button
  │     ├─► Search for service by name (e.g., "Lambda")
  │     ├─► Click matching service card
  │     └─► Wait for configuration page load
  │
  ├─► PHASE 2: Section Discovery
  │     ├─► Scan visible DOM for panel headers
  │     ├─► Identify collapsible sections via aria-controls
  │     ├─► Filter noise sections (footer actions, region labels)
  │     ├─► Build section list with trigger strategies
  │     └─► Expand all sections for full inventory
  │
  ├─► PHASE 3: DOM Inventory Scan
  │     ├─► Scan all visible interactive elements
  │     ├─► Extract: tag, roles, attributes, text content
  │     ├─► Compute bounding boxes via CDP
  │     ├─► Build element inventory with visibility flags
  │     └─► Capture initial state fingerprint
  │
  ├─► PHASE 4: BFS Dimension Exploration
  │     │
  │     ├─► For each section (BFS order):
  │     │   ├─► Discover all interactive controls
  │     │   ├─► Classify control type:
  │     │   │   ├─► CHECKBOX_TOGGLE → record gate control
  │     │   │   ├─► RADIO_CARD → record selection group
  │     │   │   ├─► SELECT_GATE → record dropdown options
  │     │   │   └─► NUMBER/TEXT inputs → record dimension
  │     │   ├─► Capture dropdown options for SELECT/RADIO
  │     │   ├─► Toggle state exploration (if applicable):
  │     │   │   ├─► Toggle ON → capture new DOM state
  │     │   │   ├─► Discover newly revealed controls
  │     │   │   └─► Toggle OFF → restore baseline
  │     │   └─► Deduplicate dimensions by key + location
  │     │
  │     ├─► Gate Control Discovery:
  │     │   ├─► Identify CHECKBOX_TOGGLE controls
  │     │   ├─► Identify RADIO_CARD groups
  │     │   ├─► Identify SELECT_GATE dropdowns
  │     │   └─► Record default states and options
  │     │
  │     └─► State fingerprint tracking:
  │         ├─► Compute DOM fingerprint after each toggle
  │         ├─► Skip already-visited states
  │         └─► Enforce max_states budget (default: 50)
  │
  ├─► PHASE 5: Draft Assembly
  │     ├─► Normalize dimension keys (strip placeholder text)
  │     ├─► Merge unit selectors with value fields
  │     ├─► Infer field types via heuristics:
  │     │   ├─► "toggle"/"enable"/"disable" → TOGGLE
  │     │   ├─► "type"/"class"/"mode"/"os" → SELECT
  │     │   ├─► "region"/"location" → SELECT
  │     │   ├─► "instance"/"node type" → INSTANCE_SEARCH
  │     │   └─► "count"/"amount"/"requests" → NUMBER
  │     ├─► Auto-infer default values for unit-like fields
  │     ├─► Assign section metadata to dimensions
  │     ├─► Build ServiceDraft object with:
  │     │   ├─► service_name, service_id, search_term
  │     │   ├─► calculator_page_title
  │     │   ├─► dimensions[] with scan_meta
  │     │   ├─► gate_controls[]
  │     │   ├─► exploration_states[]
  │     │   └─► exploration_budget_hit flag
  │     └─► Write draft to config/services/generated/<service>_draft.json
  │
  ├─► PHASE 6: Vision Gate (Optional)
  │     ├─► Capture screenshot of current page
  │     ├─► Send to VLM for visual verification
  │     ├─► Receive confidence scores per dimension
  │     ├─► Flag low-confidence captures for review
  │     └─► Update scan_meta.confidence fields
  │
  ├─► PHASE 7: Options Scan
  │     ├─► For each SELECT/RADIO/COMBOBOX dimension:
  │     │   ├─► Open dropdown
  │     │   ├─► Capture all option labels
  │     │   ├─► Handle dynamic option loading
  │     │   └─► Close dropdown
  │     └─► Enrich dimension.options arrays
  │
  ├─► PHASE 8: Conflict Resolution
  │     ├─► Detect duplicate dimension keys
  │     ├─► Detect ambiguous field types
  │     ├─► Detect missing required metadata
  │     └─► Apply resolution strategies
  │
  ├─► PHASE 9: Draft Promotion (Automatic Chain)
  │     │
  │     ├─► Load draft from generated/
  │     ├─► Normalize to ServiceCatalogEntry schema
  │     ├─► Interactive Review:
  │     │   ├─► Display dimension summary table
  │     │   ├─► Highlight UNKNOWN field types
  │     │   ├─► Show quality gate metrics:
  │     │   │   ├─► Unknown ratio
  │     │   │   ├─► Duplicate ratio
  │     │   │   ├─► Sectionless ratio
  │     │   │   └─► Required SELECTs without options
  │     │   ├─► Auto-infer UNKNOWN types via heuristics
  │     │   ├─► User can:
  │     │   │   ├─► Prune noisy dimensions
  │     │   │   ├─► Correct field types manually
  │     │   │   ├─► Edit dimension keys
  │     │   │   └─► Add missing options
  │     │   └─► Re-run quality gate after edits
  │     │
  │     ├─► Quality Gate Evaluation:
  │     │   ├─► Evaluate against PROMOTED thresholds
  │     │   ├─► Warn if thresholds exceeded
  │     │   └─► Allow proceed/abort decision
  │     │
  │     └─► Write Validated Catalog:
  │         ├─► Serialize to config/services/<service_id>.json
  │         ├─► Validate against ServiceCatalogEntry Pydantic model
  │         └─► Confirm availability to Builder mode
  │
  └─► artifact_emitter.finalize()
        ├─► Write exploration_report.json
        ├─► Save screenshots of key states
        └─► Print summary table
```

---

### 3.10.2 Promote Mode — Detailed Flow (Mode D)

```
  START: python main.py promote --draft config/services/generated/lambda_draft.json
  │
  ├─► Load Draft
  │     ├─► Read from specified path or auto-discover latest
  │     ├─► Validate draft structure
  │     └─► Display service metadata
  │
  ├─► Quality Gate Pre-Check
  │     ├─► Evaluate RAW_CAPTURE_THRESHOLDS:
  │     │   ├─► max_unknown_ratio: 0.50
  │     │   ├─► max_duplicate_ratio: 0.85
  │     │   ├─► max_sectionless_ratio: 0.95
  │     │   └─► max_required_select_without_options: 2
  │     └─► Display quality metrics
  │
  ├─► Auto-Inference Pass
  │     ├─► For each dimension with field_type=UNKNOWN:
  │     │   ├─► Apply heuristic rules:
  │     │   │   ├─► /toggle|enable|disable/i → TOGGLE
  │     │   │   ├─► /type|class|mode|policy/i → SELECT
  │     │   │   ├─► /region|location/i → SELECT
  │     │   │   ├─► /instance|node type/i → INSTANCE_SEARCH
  │     │   │   └─► /count|amount|rate|hours/i → NUMBER
  │     │   ├─► Update field_type if match found
  │     │   └─► Log inference for user review
  │     │
  │     ├─► For unit-like SELECT/RADIO dimensions:
  │     │   ├─► Infer default_value from:
  │     │   │   ├─► Explicit unit match (e.g., "GB" option for "Storage" key)
  │     │   │   ├─► Key suffix match
  │     │   │   ├─► Common frequency preference
  │     │   │   └─► First option fallback
  │     │   └─► Set default_value
  │     │
  │     └─► Normalize dimension keys:
  │         ├─► Strip "Enter ..." placeholder prefixes
  │         ├─► Strip "(optional)" suffixes
  │         └─► Normalize whitespace
  │
  ├─► Interactive Review Loop
  │     │
  │     ├─► Display dimension table:
  │     │   ┌──────────────────────────────────────────────────────┐
  │     │   │  Key                    │ Type        │ Section     │
  │     │   │  ─────────────────────  │ ──────────  │ ──────────  │
  │     │   │  Memory allocated       │ NUMBER      │ Configuration │
  │     │   │  Duration per request   │ NUMBER      │ Configuration │
  │     │   │  Number of requests     │ NUMBER      │ Usage        │
  │     │   │  [UNKNOWN] Provisioned  │ UNKNOWN ❌   │ Settings     │
  │     │   └──────────────────────────────────────────────────────┘
  │     │
  │     ├─► User Actions:
  │     │   ├─► [1] Edit field type
  │     │   ├─► [2] Edit dimension key
  │     │   ├─► [3] Prune dimension
  │     │   ├─► [4] Add options to SELECT
  │     │   ├─► [5] Re-evaluate quality
  │     │   └─► [S] Save and exit
  │     │
  │     └─► After each edit:
  │         ├─► Update preview
  │         └─► Re-calculate quality metrics
  │
  ├─► Quality Gate Post-Check
  │     ├─► Evaluate PROMOTED_THRESHOLDS:
  │     │   ├─► max_unknown_ratio: 0.20
  │     │   ├─► max_duplicate_ratio: 0.35
  │     │   ├─► max_required_select_without_options: 0
  │     │   └─► ...
  │     ├─► If thresholds exceeded:
  │     │   ├─► Display warnings
  │     │   └─► Prompt: "Proceed anyway? [y/N]"
  │     └─► If all pass:
  │         └─► Display success message
  │
  ├─► Schema Validation
  │     ├─► Normalize to ServiceCatalogEntry
  │     ├─► Validate with Pydantic
  │     └─► Handle validation errors
  │
  └─► Write Catalog
        ├─► Serialize to config/services/<service_id>.json
        ├─► Confirm write success
        └─► Print availability message
```

---

### 3.11 Region Code Mapping

AWS Calculator displays regions as human-readable strings, but profiles store them as AWS region codes. A static mapping table bridges the two.

```
  PROFILE          ──►   AWS CALCULATOR UI
  ───────────────────────────────────────────────────
  us-east-1        ──►   US East (N. Virginia)
  us-east-2        ──►   US East (Ohio)
  us-west-1        ──►   US West (N. California)
  us-west-2        ──►   US West (Oregon)
  eu-west-1        ──►   Europe (Ireland)
  eu-central-1     ──►   Europe (Frankfurt)
  ap-southeast-1   ──►   Asia Pacific (Singapore)
  ap-northeast-1   ──►   Asia Pacific (Tokyo)
  global           ──►   (no region selector — skipped)
  ───────────────────────────────────────────────────
  Stored in: config/region_map.json
```

---

### 3.12 Error Handling Strategy

```
ERROR TAXONOMY
══════════════════════════════════════════════════════════════════════
  LAYER               ERROR CLASS          RESPONSE
  ──────────────────  ───────────────────  ─────────────────────────
  Profile Load        SchemaValidationError   Print all violations,
                                              exit before browser

  Value Resolution    UnresolvedRequired      List all missing dims,
                                              exit before browser

  Browser Launch      BrowserStartError       Log + exit (no artifact
                                              to write yet)

  Navigation          PageLoadError           Retry × 3, then abort
                                              + screenshot

  Service Search      ServiceNotFoundError    Skip service, log warn,
                                              mark SKIPPED in artifact
                                              + screenshot

  Find in Page        DimensionNotFoundError  Retry × 2, skip dim,
                                              mark SKIPPED, screenshot

  Field Interaction   FillError               Retry × 2, mark FAILED,
                                              screenshot, continue
                                              to next dimension

  Final Write         ArtifactWriteError      Print to stdout as
                                              fallback
══════════════════════════════════════════════════════════════════════

RETRY POLICY
─────────────────────────────────────────────────────────────────────
  Max retries per step   : 2
  Delay between retries  : 1.5s (linear, not exponential)
  Retry triggers         : timeout, element not found, stale handle
  Hard stop triggers     : browser crash, OS-level error
─────────────────────────────────────────────────────────────────────

FAIL FAST vs FAIL FORWARD
─────────────────────────────────────────────────────────────────────
  Before browser open   ──► FAIL FAST   (abort whole run)
  During automation     ──► FAIL FORWARD (skip + continue,
                             capture artifact of partial result)
─────────────────────────────────────────────────────────────────────
```

---

### 3.13 CLI Interface

```
USAGE
─────────────────────────────────────────────────────────────────────

  Interactive mode picker (no args):
  $ python main.py

  Build a new profile interactively:
  $ python main.py build

  Run automation against an existing profile:
  $ python main.py run --profile profiles/ecommerce.json

  Validate profile without opening browser:
  $ python main.py run --profile profiles/ecommerce.json --dry-run

  Verify mode (locator-only health check, no value fill):
  $ python main.py run --profile profiles/ecommerce.json --verify

  Run headless (no visible browser window):
  $ python main.py --run --profile profiles/ecommerce.json --headless

  Override a single dimension value at run time:
  $ python main.py run --profile profiles/ecommerce.json \
      --set "Frontend Web Tier/Amazon EC2/Number of Instances=5"

  Explore mode (scan live calculator page, draft new service catalog):
  $ python main.py explore --service lambda --headless

  Promote mode (convert draft catalog to validated service catalog):
  $ python main.py promote --draft config/services/generated/lambda_draft.json

  Keep browser open after successful run:
  $ python main.py run --profile profiles/ecommerce.json --keep-open

  Disable catalog self-healing:
  $ python main.py run --profile profiles/ecommerce.json --no-heal

  Skip prompts for unresolved dimensions (fail fast):
  $ python main.py run --profile profiles/ecommerce.json --no-prompt

─────────────────────────────────────────────────────────────────────

TERMINAL OUTPUT (during --run)
─────────────────────────────────────────────────────────────────────

  [✓] Profile loaded: E-Commerce Replatform (2 groups, 4 services)
  [✓] All values resolved — no prompts required
  [✓] Browser launched

  Group 1/2 — Frontend Web Tier
    Service 1/2 — Amazon EC2 (Web Servers)
      [✓] Service found and opened
      [✓] Region set: US East (N. Virginia)
      [✓] Operating System       ──► Linux
      [✓] Instance Type          ──► t3.medium
      [✓] Number of Instances    ──► 3
      [✓] Added to estimate
    Service 2/2 — Amazon CloudFront (CDN)
      [✓] Service found and opened
      [!] Dimension skipped      ──► Data Transfer Out (not found)
      [✓] Added to estimate

  Group 2/2 — Database Tier
    ...

  [✓] Run complete — status: partial_success
  [✓] Artifact written: outputs/run_result.json
  [!] 1 screenshot saved: outputs/screenshots/
  [✓] Calculator URL: https://calculator.aws/#/estimate?id=abc123

─────────────────────────────────────────────────────────────────────
```

---

### 3.14 Component Interaction Summary

```
┌──────────┐   profile.json   ┌──────────────┐  ProfileDocument  ┌──────────────┐
│  main.py │ ───────────────► │profile_loader│ ────────────────► │value_resolver│
└──────────┘                  └──────────────┘                   └──────┬───────┘
     │                                                                  │
     │  (Mode A)                                              resolved dim map
     │                                                                  │
     ▼                                                                  ▼
┌──────────────────┐   service list    ┌──────────────┐       ┌─────────────────┐
│interactive_builder│ ◄─────────────── │service_catalog│       │ browser_session │
└──────────────────┘                  └─��────────────┘       └────────┬────────┘
     │                                      │                         │
     │  profile.json                        │ field_type hints        │
     ▼                                      ▼                         ▼
┌──────────┐                        ┌──────────────┐         ┌───────────────┐
│ profiles/│                        │field_interact│ ◄────── │   navigator   │
│ *.json   │                        └──────┬───────┘         └───────┬───────┘
└──────────┘                               │                         │
                                           │                         │
                                    fill result               ┌──────┴──────────┐
                                           │                  │find_in_page     │
                                           │                  │_locator         │
                                           │                  └─────────────────┘
                                           ▼
                                   ┌──────────────────┐
                                   │ artifact_emitter  │
                                   │ run_result.json   │
                                   │ screenshots/      │
                                   └──────────────────┘
```